# Docs for the Azure Web Apps Deploy action: https://github.com/Azure/webapps-deploy
# More GitHub Actions for Azure: https://github.com/Azure/actions

name: DEV Build & Deploy ALL

on:
  workflow_dispatch: {}  # This makes the workflow manually triggerable

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger TEST Workflows
        run: |
          prefix="TEST"
          repo="${{ github.repository }}"
          token="${{ secrets.GITHUB_TOKEN }}"

          # List all workflows in the repository
          workflows=$(curl -s "https://api.github.com/repos/$repo/actions/workflows" -H "Authorization: token $token" | jq -r '.workflows[].name')

          # Loop through the workflows and trigger the ones with the specified prefix
          for workflow in $workflows; do
            if [[ $workflow == $prefix* ]]; then
              curl -X POST "https://api.github.com/repos/$repo/actions/workflows/$workflow/dispatches" \
                -H "Authorization: token $token" \
                -H "Accept: application/vnd.github.v3+json" \
                -d '{"ref": "main"}'
            fi
          done
        env:
          prefix: ${{ env.TEST_PREFIX }}
        if: startsWith(github.event.client_payload.workflow, env.prefix) || env.prefix == 'ALL'
